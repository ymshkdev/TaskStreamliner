<%# カレンダーからのクリック時は turbo_frame_tag の中身だけが抜き出される %>
<%= turbo_frame_tag "modal_task_detail" do %>
 <div class="task-detail-container modal-style-adjust">
  <div class="task-card">

    <div class="task-header">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
        <div style="display: flex; align-items: center; gap: 10px;">
         <%# タイプのバッジ（タスク or 予定） %>
        <span class="type-badge type-<%= @task.task_type %>" style="font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; background: #eee; color: #666;">
         <%= @task.task_type_i18n %>
        </span>
        <%# 優先度バッジ %>
        <span class="priority-badge priority-<%= @task.priority %>">
          <%= @task.priority_i18n if @task.priority %>
        </span>
      </div>
      <%# --- モーダル内限定：クイックステータス変更 --- %>
          <% if @task.todo? %>
            <div class="quick-status-edit">
              <%= form_with(model: @task, class: "quick-status-form") do |f| %>
                <%= f.select :status, Task.statuses.keys.map { |k| [I18n.t("enums.task.status.#{k}"), k] }, {}, 
                    { onchange: "this.form.requestSubmit();", class: "status-select-small" } %>
              <% end %>
            </div>
          <% end %>
        </div>

    <div class="task-body"style="margin-top: 20px;">
      <% if @task.todo? %>
        <%# タスク（締切）の場合 %>
        <div class="info-group">
          <label>期限</label>
          <p><%= @task.deadline&.strftime("%Y年%m月%d日 %H:%M") || "未設定" %></p>
        </div>
        <p>
        <strong>ステータス:</strong>
         <span class="status-label status-<%= @task.status %>">
          <%= I18n.t "enums.task.status.#{@task.status}" %>
         </span>
        </p>
      <% else %>
        <%# 予定（期間）の場合 %>
        <div class="info-group">
          <label>日時</label>
          <p>
            <%= @task.start_at&.strftime("%Y年%m月%d日 %H:%M") %> 〜 
            <br>
            <%= @task.end_at&.strftime("%Y年%m月%d日 %H:%M") %>
          </p>
        </div>
      <% end %>

      <div class="info-group">
        <label>メモ</label>
        <%# labelは常に出し、pタグの中身だけ条件分岐させます %>
        <p>
          <%= simple_format(@task.description) if @task.description.present? %>
        </p>
      </div>
    </div>

    <hr>
<h4>コメント</h4>

<div id="comments">
  <%= render @task.comments %>
</div>

<hr>

<%= render "comments/form", task: @task, comment: Comment.new %>

    <div class="task-actions">
      <%= link_to "編集する", edit_task_path(@task), data: { turbo_frame: "_top" }, class: "btn-edit" %>
      <%= link_to "削除する", task_path(@task), 
                  data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, 
                  class: "btn-delete" %>
      <% unless request.headers["Turbo-Frame"] %>
      <%= link_to "カレンダーに戻る", tasks_path, class: "btn-back" %>
      <% end %>
    </div>
  </div>
 </div>
<% end %>