<div class="google-calendar-layout">
  <div class="sidebar">
    <div class="mini-calendar-section">
  <%# 1. å¹´æœˆã¨åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ç‹¬è‡ªãƒ˜ãƒƒãƒ€ãƒ¼ %>
  <div class="custom-calendar-header">
    <%= link_to "å‰æœˆ", day_tasks_path(date: @date, start_date: @start_date.prev_month), class: "nav-btn" %>
    
    <span class="calendar-title-js">
      <span class="year"><%= @start_date.year %></span>å¹´ 
      <span class="month"><%= @start_date.month %></span>æœˆ
    </span>
    
    <%= link_to "æ¬¡æœˆ", day_tasks_path(date: @date, start_date: @start_date.next_month), class: "nav-btn" %>
  </div>

  <%# 2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ï¼šheader: false ã§ Gemæ¨™æº–ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç”Ÿæˆã•ã›ãªã„ %>
  <div class="mini-calendar-body">
    <%= month_calendar(events: @month_tasks, start_date: @start_date, header: false) do |date, tasks| %>
     <% 
      # ä¼‘æ—¥ãƒ»åœŸæ—¥åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
      holiday = HolidayJp.between(date, date).first
      date_class = if holiday || date.sunday?
                     'text-danger' # ç¥æ—¥ãƒ»æ—¥æ›œã¯èµ¤
                   elsif date.saturday?
                     'text-info'   # åœŸæ›œã¯é’ï¼ˆBootstrapã®infoã‚«ãƒ©ãƒ¼ï¼‰
                   else
                     ''
                   end
    %>
      <div class="mini-day-cell <%= 'active-day' if date == @date %>">
        <%= link_to date.day, day_tasks_path(date: date, start_date: @start_date), 
                  class: date_class, 
                  style: "font-size: 0.8rem; text-decoration: none;" %>
      </div>
    <% end %>
  </div>
</div>

    <div class="todo-sidebar-section">
      <h3 class="sidebar-title">æœªå®Œäº†ã‚¿ã‚¹ã‚¯</h3>
      <div class="todo-list-scroll">
        <% @todo_list.each do |todo| %>
          <div class="todo-item">
            <span class="priority"><%= "ðŸš©" if todo.priority_high? %></span>
            <span class="title"><%= todo.title %></span>
            <span class="date"><%= todo.deadline&.strftime("%m/%d") %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="timeline-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <%= link_to "â† ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æˆ»ã‚‹", tasks_path(start_date: @start_date), class: "btn btn-outline-secondary btn-sm me-3" %>
        <% # åœŸæ—¥ç¥ã®åˆ¤å®š
         is_holiday = HolidayJp.between(@date, @date).first
         date_color_class = if is_holiday || @date.sunday?
                            'text-danger'
                            elsif @date.saturday?
                            'text-info'
                            else
                            ''
                            end
         %>
      <div class="date-display d-flex align-items-baseline">
       <%# 1. æ•°å­—éƒ¨åˆ†ã«è‰²ã‚’é©ç”¨ %>
       <span class="day-num <%= date_color_class %>" style="font-size: 1.5rem; font-weight: bold;">
        <%= @date.day %>
       </span>
      <%# 2. æ›œæ—¥éƒ¨åˆ†ï¼šåœŸæ—¥ç¥ãªã‚‰è‰²ã‚’ä»˜ã‘ã€å¹³æ—¥ãªã‚‰å…ƒã® text-muted ã‚’ä½¿ã† %>
      <span class="day-name ms-2 <%= date_color_class.presence || 'text-muted' %>">
        <%= I18n.t('date.abbr_day_names')[@date.wday] %>(<%= @date.strftime("%a") %>)
        <% if is_holiday %>
          <small class="ms-1" style="font-size: 0.8rem;">- <%= is_holiday.name %></small>
        <% end %>
      </span>
    </div>
        <%= link_to "ä»Šæ—¥", day_tasks_path(date: Date.today), class: "btn btn-sm btn-light border ms-3" %>
      </div>
      <%= link_to '+ ä½œæˆ', new_task_path(selected_date: @date), class: "btn btn-primary shadow-sm" %>
    </div>

    <div class="day-timeline">
      <% (0..23).each do |hour| %>
        <div class="hour-row">
          <div class="hour-label"><%= sprintf("%02d:00", hour) %></div>
          <div class="hour-slot"></div>
        </div>
      <% end %>

      <div class="events-container">
        <% @day_tasks.each do |task| %>
          <% if task.schedule? %>
            <% 
              top = (task.start_at.hour * 60) + (task.start_at.min)
              height = ((task.end_at - task.start_at) / 60).to_i
            %>
            <div class="event-block" style="top: <%= top %>px; height: <%= height %>px;">
              <div class="event-inner">
                <strong><%= task.title %></strong>
                <p><%= task.start_at.strftime("%H:%M") %> - <%= task.end_at.strftime("%H:%M") %></p>
              </div>
            </div>
          <% elsif task.todo? && task.deadline.present? %>
            <div class="deadline-line" style="top: <%= (task.deadline.hour * 60) + (task.deadline.min) %>px;">
              <span class="deadline-text">ã€† <%= task.title %> (<%= task.deadline.strftime("%H:%M") %>)</span>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>